<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/> 
<!-- use the latest IE browser always, and optionally use chrome frame if installed -->
<meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1" />
<script src="/_packages/document.js"></script>
<link rel="stylesheet" href="/_packages/document.css"/>
<title>HelloJS Server</title>
<h1>hello-server</h1>
<p>Authenticate OAuth2 server side</p>
<blockquote>
	<p>HelloJS Server interoperates with the <a href="http://adodson.com/hello.js">HelloJS client side SDK</a> to handle OAuth 2.0 response used with the "code" interface. In addition to completing the OAuth 1.0 authorization and signing of requests.</p>
</blockquote>
<h2>First save your credentials to the server</h2>

<h2>Authentication OAuth 2.0</h2>
<p>The OAuth2 flow starts by your application sending a client out to a providers site to grant permissions. The response is an authorization code "[AUTH_CODE]" which is returned to your site, this needs to be exchanged for an Access Token. Deliver this code to the auth-server with your client_id to exhchange for the new token, e.g.</p>
<pre>
https://auth-server.herokuapp.com/?redirect_uri=[REDIRECT_PATH]&code=[AUTH_CODE]&client_id=[APP_KEY]&network=[NETWORK_NAME]&state=[STATE]
</pre>
<p>The client will be redirected back to the location of [REDIRECT_PATH], with the contents of the server response as well as whatever was defined in the [STATE] in the hash.
<pre>
[REDIRECT_PATH]#state=[STATE]&access_token=ABCD1233234&expires=123123123
</pre>


<h2>Authentication OAuth 1.0</h2>
<p>OAuth 1.0 is has a number of steps so forgive the verbosity here. Your app needs to make an initial request to the auth-server, which in-turn initiates the authentication flow.</p>
<pre>
https://auth-server.herokuapp.com/?redirect_uri=[REDIREC_PATH]&request=[OAUTH_REQUEST_TOKEN_URL]&auth=[OAUTH_AUTHORIZATION_URL]&token=[OAUTH_TOKEN_URL]&client_id=[APP_KEY]&state=[STATE]&network=[NETWORK_NAME]
</pre>
<p>The client's request is signed and redirected to the [OAUTH_AUTHRIZATION_URL] with the new oauth_token and the oauth_callback is the [REDIRECT_PATH + ...other state properties].</p>
<pre>
[OAUTH_AUTHORIZATION_URL]?oauth_token=ABCD1234&oauth_callback=[[REDIRECT_PATH]?state=[STATE]&proxy_url=https://auth-server.herokuapp.com&token_url=[OAUTH_TOKEN_URL]&redirect_uri=[REDIRECT_PATH]&request=[OAUTH_REQUEST_TOKEN_URL]&auth=&token=[OAUTH_TOKEN_URL]&client_id=[APP_KEY]]
</pre>
<p>Once the user has completed they are returned to redirect_path, with the parameters you already defined plus a "oauth_token" and an optional "oauth_verifier" property. e.g.<p>
<pre>
[REDIRECT_PATH]?state=[STATE]&proxy_url=https://auth-server.herokuapp.com&token_url=[]]&redirect_uri=[REDIREC_PATH]&request=[OAUTH_REQUEST_TOKEN_URL]&auth=&token=[OAUTH_TOKEN_URL]&client_id=[APP_KEY]&oauth_token=abc12465
</pre>
<p>The [REDIRECT_PATH], hosted on your domain, must then send the authorized oauth_token to be exchanged for an access token.</p>

<p>Send the client back to the auth-server with this token</p>
<pre>
https://auth-server.herokuapp.com?oauth_token=abc12465&redirect_uri=[REDIRECT_PATH]&state=[STATE]&token=[OAUTH_TOKEN_URL]&client_id=[APP_KEY]&network=[NETWORK_NAME]
</pre>
</p>The auth-server shall return an access_token which can be used in conjunction with the auth-server to sign subsequent API REST requests.</p>
<pre>
[REDIRECT_PATH]#state=[STATE]&access_token=ABCD1233234&expires=123123123
</pre>

<h2>OAuth 1.0 signing API Calls</h2>
<p>The OAuth 1.0 API requires that each request is uniquely signed with the application secret. This restriction was removed in OAuth 2.0.</p>
<p>To sign a request to [API_PATH], use the [access_token] returned in OAuth 1.0 above and send to the auth-server</p> 
<pre>
https://auth-server.herokuapp.com?access_code=[ACCESS_CODE]&path=[API_PATH]
</pre>
<p>The response redirects the requests to the [API_PATH] and signs it for you. e.g.</p>
<pre>
[API_PATH]?oauth_token=asdf&oauth_consumer_key=asdf&...&oauth_signature=1234
</pre>


<h2>hello-server.js</h2>
<pre>

// include the library
var hello = require('hello-server');

// Define the services which your server needs to support
hello.init({
	'github' : {
		id : <q>YOUR CLIENT ID HERE</q>,
		secret : <q>YOUR CLIENT SECRET HERE</q>,
		grant_url : ''
	}
});

// start web server
var http = require('http');

var app = http.createServer(function(req,res){

});

hello.listen(app);

</pre>


<h2>hello-modules.js</h2>
<pre>
module.exports = {
	'google' : {
		oauth :{
			grant : 'https://accounts.google.com/o/oauth2/token'
		}
	},
	'facebook' : {
		oauth :{
			grant : 'https://graph.facebook.com/oauth/access_token'
		}
	},
	'windows' : {
		oauth :{
			grant : 'https://login.live.com/oauth20_token.srf'
		}
	},
	'github' : {
		oauth :{
			grant : 'https://github.com/login/oauth/access_token'
		}
	}
	//...
}

</pre>